<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
            <title> - initial_conditions_dimonte_fft1.h</title>
        <link href="http://basilisk.fr/css/custom.css" rel="stylesheet" media="screen, projection" type="text/css" />
    <link href="http://basilisk.fr/css/print.css" rel="stylesheet" media="print" type= "text/css" />
        <!--[if IE]><link href="http://basilisk.fr/css/ie.css" rel="stylesheet" media="screen, projection" type="text/css" /><![endif]-->
    <link rel="stylesheet" href="http://basilisk.fr/css/basilisk.css"/>
    <script src="http://basilisk.fr/js/jquery.min.js" type="text/javascript"></script>
    <script src="http://basilisk.fr/js/jquery-ui.packed.js" type="text/javascript"></script>
    <script src="http://basilisk.fr/js/plots.js" type="text/javascript"></script>
<link rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css"
      integrity="sha384-yFRtMMDnQtDRO8rLpMIKrtPCD5jdktao2TV19YiZYWMDkUR5GQZR/NOVTdquEx1j"
      crossorigin="anonymous"/>
<script defer
	src="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.js"
	integrity="sha384-9Nhn55MVVN0/4OFx7EE5kpFBPsEMZxKTCnA+4fqDmg12eCTqGi6+BB2LjY8brQxJ"
	crossorigin="anonymous">
</script>
  </head>
  <body>
    <div id="doc3" class="yui-t1">
        <div id="yui-main">
          <div id="maincol" class="yui-b">
<div id="userbox">
  <noscript>
    <a href="http://basilisk.fr/_login">Login</a>
    <a href="http://basilisk.fr/_logout">Logout</a>
  </noscript>
  &nbsp;
  <a id="loginlink" class="login" href="http://basilisk.fr/_login">Login / Get an account</a>
  <a id="logoutlink" class="login" href="http://basilisk.fr/_logout">Logout <span id="logged_in_user"></span></a>
</div>
<ul class="tabs">
  <li class=selected><a href="http://basilisk.fr/initial_conditions_dimonte_fft1.h">view</a></li><li><a href="http://basilisk.fr/initial_conditions_dimonte_fft1.h?history">history</a></li>
</ul>
<div id="content">
        <h1 class="pageTitle"><a href="http://basilisk.fr/initial_conditions_dimonte_fft1.h">initial_conditions_dimonte_fft1.h</a></h1>
  <ul class="messages" id="messages"></ul>
  <div id="status"></div>
    <div id="TOC">
<ul>
<li><a href="#initializing-an-interface-using-a-1d-spectrum"
id="toc-initializing-an-interface-using-a-1d-spectrum">Initializing an
interface using a 1D spectrum</a>
<ul>
<li><a
href="#save-the-initial-perturbation-in-a-gnuplot-compatible-format"
id="toc-save-the-initial-perturbation-in-a-gnuplot-compatible-format">Save
the initial perturbation in a gnuplot-compatible format</a>
<ul>
<li><a
href="#save_data_for_gnuplot_complex-saves-a-complex-1d-array-as-a-.dat-file"
id="toc-save_data_for_gnuplot_complex-saves-a-complex-1d-array-as-a-.dat-file"><em>save_data_for_gnuplot_complex()</em>:
saves a (complex) 1D array as a .dat file</a></li>
<li><a
href="#save_data_for_gnuplot_real-saves-a-1d-array-as-a-.dat-file"
id="toc-save_data_for_gnuplot_real-saves-a-1d-array-as-a-.dat-file"><em>save_data_for_gnuplot_real()</em>:
saves a 1D array as a .dat file</a></li>
</ul></li>
<li><a
href="#generate-the-perturbation-in-fourier-space-and-return-to-physical-space"
id="toc-generate-the-perturbation-in-fourier-space-and-return-to-physical-space">Generate
the perturbation in Fourier space and return to physical space</a>
<ul>
<li><a
href="#init_1d_complex-initializes-the-perturbation-in-fourier-space"
id="toc-init_1d_complex-initializes-the-perturbation-in-fourier-space"><em>init_1D_complex()</em>:
initializes the perturbation in Fourier space</a></li>
</ul></li>
<li><a href="#apply-the-initial-condition-to-a-scalar-field"
id="toc-apply-the-initial-condition-to-a-scalar-field">Apply the initial
condition to a <span class="dt">scalar</span> field</a>
<ul>
<li><a
href="#initial_condition_dimonte_fft-initializes-a-scalar-field-f"
id="toc-initial_condition_dimonte_fft-initializes-a-scalar-field-f"><em>initial_condition_dimonte_fft()</em>:
initializes a <span class="dt">scalar</span> field f</a></li>
</ul></li>
</ul></li>
</ul>
</div>
<h1 id="initializing-an-interface-using-a-1d-spectrum">Initializing an
interface using a 1D spectrum</h1>
<p>To initialize an interface using a 2D spectum see <a
href="initial_conditions_dimonte_fft2.h">here</a>.</p>
<p>To initialize the interface weâ€™ll use a 1 Fourier transform and some
interpolation routines from <code>GSL</code>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;gsl/gsl_fft_complex.h&gt;</span><span class="pp"><span id=11></span></span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;gsl/gsl_complex.h&gt;</span><span class="pp"><span id=12></span></span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;gsl/gsl_complex_math.h&gt;</span><span class="pp"><span id=13></span></span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;gsl/gsl_spline.h&gt;</span><span class="pp"><span id=14></span></span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#pragma autolink -lgsl -lgslcblas<span id=15></span></span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#define REAL</span><span class="op">(</span><span class="pp">z</span><span class="op">,</span><span class="pp">i</span><span class="op">)</span><span class="pp"> </span><span class="op">((</span><span class="pp">z</span><span class="op">)[</span><span class="dv">2</span><span class="op">*(</span><span class="pp">i</span><span class="op">)])</span><span class="pp"><span id=16></span></span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#define IMAG</span><span class="op">(</span><span class="pp">z</span><span class="op">,</span><span class="pp">i</span><span class="op">)</span><span class="pp"> </span><span class="op">((</span><span class="pp">z</span><span class="op">)[</span><span class="dv">2</span><span class="op">*(</span><span class="pp">i</span><span class="op">)+</span><span class="dv">1</span><span class="op">])</span><span class="pp"><span id=17></span><span id=18></span></span></span></code></pre></div>
<h2
id="save-the-initial-perturbation-in-a-gnuplot-compatible-format">Save
the initial perturbation in a gnuplot-compatible format</h2>
<h3
id="save_data_for_gnuplot_complex-saves-a-complex-1d-array-as-a-.dat-file"><em>save_data_for_gnuplot_complex()</em>:
saves a (complex) 1D array as a .dat file</h3>
<div class="sourceCode" id="cb2"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <a href=initial_conditions_dimonte_fft1.h#save_data_for_gnuplot_complex>save_data_for_gnuplot_complex</a><span class="op">(</span><span class="dt">double</span> <span class="op">*</span>data<span class="op">,</span> <span class="dt">int</span> NX<span class="op">,</span> <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>filename<span class="op">){</span><span id=24></span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">FILE</span> <span class="op">*</span>file <span class="op">=</span> <a href=http://man7.org/linux/man-pages/man3/fopen.3.html>fopen</a><span class="op">(</span>filename<span class="op">,</span> <span class="st">&quot;w&quot;</span><span class="op">);</span><span id=25></span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>file <span class="op">==</span> NULL<span class="op">){</span><span id=26></span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <a href=http://man7.org/linux/man-pages/man3/fprintf.3.html>fprintf</a><span class="op">(</span><a href=http://man7.org/linux/man-pages/man3/stderr.3.html>stderr</a><span class="op">,</span> <span class="st">&quot;Error opening file </span><span class="sc">%s\n</span><span class="st">&quot;</span><span class="op">,</span> filename<span class="op">);</span><span id=27></span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span><span class="op">;</span><span id=28></span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span><span id=29></span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span id=30></span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> NX<span class="op">;</span> i<span class="op">++){</span><span id=31></span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> magnitude <span class="op">=</span> sqrt<span class="op">(</span>sq<span class="op">(</span>REAL<span class="op">(</span>data<span class="op">,</span> i<span class="op">))</span> <span class="op">+</span> sq<span class="op">(</span>IMAG<span class="op">(</span>data<span class="op">,</span> i<span class="op">)));</span><span id=32></span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <a href=http://man7.org/linux/man-pages/man3/fprintf.3.html>fprintf</a><span class="op">(</span>file<span class="op">,</span> <span class="st">&quot;</span><span class="sc">%d</span><span class="st"> </span><span class="sc">%f</span><span class="st"> </span><span class="sc">%f</span><span class="st"> </span><span class="sc">%f\n</span><span class="st">&quot;</span><span class="op">,</span> i<span class="op">,</span> REAL<span class="op">(</span>data<span class="op">,</span>i<span class="op">),</span> IMAG<span class="op">(</span>data<span class="op">,</span>i<span class="op">),</span> magnitude<span class="op">);</span><span id=33></span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span><span id=34></span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <a href=http://man7.org/linux/man-pages/man3/fclose.3.html>fclose</a><span class="op">(</span>file<span class="op">);</span><span id=35></span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span><span id=36></span><span id=37></span></span></code></pre></div>
<h3
id="save_data_for_gnuplot_real-saves-a-1d-array-as-a-.dat-file"><em>save_data_for_gnuplot_real()</em>:
saves a 1D array as a .dat file</h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <a href=initial_conditions_dimonte_fft1.h#save_data_for_gnuplot_real>save_data_for_gnuplot_real</a><span class="op">(</span><span class="dt">double</span> <span class="op">*</span>data<span class="op">,</span> <span class="dt">int</span> NX<span class="op">,</span> <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>filename<span class="op">){</span><span id=41></span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">FILE</span> <span class="op">*</span>file <span class="op">=</span> <a href=http://man7.org/linux/man-pages/man3/fopen.3.html>fopen</a><span class="op">(</span>filename<span class="op">,</span> <span class="st">&quot;w&quot;</span><span class="op">);</span><span id=42></span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>file <span class="op">==</span> NULL<span class="op">){</span><span id=43></span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <a href=http://man7.org/linux/man-pages/man3/fprintf.3.html>fprintf</a><span class="op">(</span><a href=http://man7.org/linux/man-pages/man3/stderr.3.html>stderr</a><span class="op">,</span> <span class="st">&quot;Error opening file </span><span class="sc">%s\n</span><span class="st">&quot;</span><span class="op">,</span> filename<span class="op">);</span><span id=44></span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span><span class="op">;</span><span id=45></span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span><span id=46></span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span id=47></span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> NX<span class="op">;</span> i<span class="op">++){</span><span id=48></span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <a href=http://man7.org/linux/man-pages/man3/fprintf.3.html>fprintf</a><span class="op">(</span>file<span class="op">,</span> <span class="st">&quot;</span><span class="sc">%d</span><span class="st"> </span><span class="sc">%f</span><span class="st"> </span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> i<span class="op">,</span> data<span class="op">[</span>i<span class="op">]);</span><span id=49></span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span><span id=50></span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <a href=http://man7.org/linux/man-pages/man3/fclose.3.html>fclose</a><span class="op">(</span>file<span class="op">);</span><span id=51></span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span><span id=52></span><span id=53></span></span></code></pre></div>
<h2
id="generate-the-perturbation-in-fourier-space-and-return-to-physical-space">Generate
the perturbation in Fourier space and return to physical space</h2>
<h3
id="init_1d_complex-initializes-the-perturbation-in-fourier-space"><em>init_1D_complex()</em>:
initializes the perturbation in Fourier space</h3>
<div class="sourceCode" id="cb4"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <a href=initial_conditions_dimonte_fft1.h#init_1D_complex>init_1D_complex</a><span class="op">(</span><span class="dt">double</span> <span class="op">*</span>data<span class="op">,</span> <span class="dt">int</span> N<span class="op">,</span> <span class="dt">double</span> kmin<span class="op">,</span> <span class="dt">double</span> kmax<span class="op">,</span> <span class="dt">double</span> eta0_target<span class="op">=</span><span class="dv">1</span><span class="op">){</span><span id=59></span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">double</span> <span class="op">*</span>kx <span class="op">=</span> <a href=http://man7.org/linux/man-pages/man3/malloc.3.html>malloc</a><span class="op">(</span>N <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">double</span><span class="op">));</span><span id=60></span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">double</span> cst <span class="op">=</span> eta0_target <span class="op">/</span> sqrt<span class="op">((</span><span class="fl">2.</span><span class="op">/</span>kmin<span class="op">)-(</span><span class="fl">2.</span><span class="op">/</span>kmax<span class="op">));</span><span id=61></span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span id=62></span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Calculate wavenumbers<span id=63></span></span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;=</span> N <span class="op">/</span> <span class="dv">2</span><span class="op">;</span> <span class="op">++</span>i<span class="op">)</span><span id=64></span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    kx<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> pi <span class="op">*</span> i <span class="op">/</span> L0<span class="op">;</span><span id=65></span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span id=66></span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> N <span class="op">/</span> <span class="dv">2</span> <span class="op">+</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;</span> N<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span><span id=67></span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    kx<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> pi <span class="op">*</span> <span class="op">(</span>i <span class="op">-</span> N<span class="op">)</span> <span class="op">/</span> L0<span class="op">;</span><span id=68></span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span id=69></span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Initialize spectrum in the specified range with magnitude 1/k and random phase<span id=70></span></span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="dt">double</span> dkx <span class="op">=</span> kx<span class="op">[</span><span class="dv">1</span><span class="op">]-</span>kx<span class="op">[</span><span class="dv">0</span><span class="op">];</span><span id=71></span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  <span class="dt">double</span> eta0 <span class="op">=</span> <span class="dv">0</span><span class="er">.</span><span class="op">;</span><span id=72></span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  memset<span class="op">(</span>data<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">2</span> <span class="op">*</span> N <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">double</span><span class="op">));</span><span id=73></span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> N<span class="op">;</span> <span class="op">++</span>i<span class="op">){</span><span id=74></span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> k <span class="op">=</span> sqrt<span class="op">(</span>sq<span class="op">(</span>kx<span class="op">[</span>i<span class="op">]));</span><span id=75></span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">((</span>k <span class="op">&gt;=</span> kmin<span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="op">(</span>k <span class="op">&lt;</span> kmax<span class="op">)){</span><span id=76></span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>      <span class="dt">double</span> magnitude <span class="op">=</span> cst <span class="op">/</span> k<span class="op">;</span><span id=77></span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>      <span class="dt">double</span> phase <span class="op">=</span> noise<span class="op">()</span> <span class="op">*</span> pi<span class="op">;</span><span id=78></span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>      REAL<span class="op">(</span>data<span class="op">,</span> i<span class="op">)</span> <span class="op">=</span> magnitude <span class="op">*</span> cos<span class="op">(</span>phase<span class="op">);</span><span id=79></span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>      IMAG<span class="op">(</span>data<span class="op">,</span> i<span class="op">)</span> <span class="op">=</span> magnitude <span class="op">*</span> sin<span class="op">(</span>phase<span class="op">);</span><span id=80></span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>      eta0 <span class="op">+=</span> sq<span class="op">(</span>magnitude<span class="op">)*</span>dkx<span class="op">;</span><span id=81></span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span>    <span id=82></span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span><span id=83></span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>  <a href=http://man7.org/linux/man-pages/man3/fprintf.3.html>fprintf</a><span class="op">(</span><a href=http://man7.org/linux/man-pages/man3/stdout.3.html>stdout</a><span class="op">,</span> <span class="st">&quot;real eta0 is </span><span class="sc">%g</span><span class="st"> </span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> sqrt<span class="op">(</span>eta0<span class="op">));</span><span id=84></span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a><span id=85></span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>  <a href=http://man7.org/linux/man-pages/man3/free.3.html>free</a><span class="op">(</span>kx<span class="op">);</span><span id=86></span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a><span class="op">}</span><span id=87></span><span id=88></span><span id=89></span></span></code></pre></div>
<h2 id="apply-the-initial-condition-to-a-scalar-field">Apply the initial
condition to a <span class="dt">scalar</span> field</h2>
<h3
id="initial_condition_dimonte_fft-initializes-a-scalar-field-f"><em>initial_condition_dimonte_fft()</em>:
initializes a <span class="dt">scalar</span> field f</h3>
<p>This function initializes a <span class="dt">scalar</span> field <code>phi</code> with a
perturbation generated using a 1D Fast Fourier Transform (FFT). The
perturbation is generated by the main process and broadcasted to other
processes if MPI is used. The perturbation can be applied directly to
the field or used to generate a Volume of Fluid (VOF) surface.</p>
<p>The arguments and their default values are:</p>
<dl>
<dt><em>phi</em></dt>
<dd>
vertex <span class="dt">scalar</span> field to be initialized.
</dd>
<dt><em>amplitude</em></dt>
<dd>
amplitude of the perturbation. Default is <em>1</em>.
</dd>
<dt><em>NX</em></dt>
<dd>
number of points along the x-dimension. Default is <em>N</em>.
</dd>
<dt><em>kmin</em></dt>
<dd>
minimum wavenumber for the perturbation. Default is <em>1</em>.
</dd>
<dt><em>kmax</em></dt>
<dd>
maximum wavenumber for the perturbation. Default is <em>1</em>.
</dd>
</dl>
<h4 id="example-usage">Example Usage</h4>
<div class="sourceCode" id="cb5"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>initial_condition_dimonte_fft<span class="op">(</span>phi<span class="op">,</span> <span class="dv">0</span><span class="er">.5</span><span class="op">,</span> <span class="dv">128</span><span class="op">,</span> <span class="dv">0</span><span class="er">.1</span><span class="op">,</span> <span class="fl">10.0</span><span class="op">);</span></span></code></pre></div>
<p>see, also <a href="test_init_fft4.c">example</a>.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> initial_condition_dimonte_fft<span class="op">(</span><a href=http://basilisk.fr/Basilisk%20C#face-and-vertex-fields>vertex</a> <span class="dt">scalar</span> phi<span class="op">,</span> <span class="dt">double</span> amplitude<span class="op">=</span><span class="dv">1</span><span class="op">,</span> <span class="dt">int</span> NX<span class="op">=</span>N<span class="op">,</span> <span class="dt">double</span> kmin<span class="op">=</span><span class="dv">1</span><span class="op">,</span> <span class="dt">double</span> kmax<span class="op">=</span><span class="dv">1</span><span class="op">){</span><span id=127></span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span id=128></span>  </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">// We declare the arrays and initialize the physical space<span id=129></span></span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">double</span> <span class="op">*</span>data <span class="op">=</span> <a href=http://man7.org/linux/man-pages/man3/malloc.3.html>malloc</a><span class="op">(</span><span class="dv">2</span> <span class="op">*</span> NX <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">double</span><span class="op">));</span><span id=130></span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">double</span> <span class="op">*</span>xdata <span class="op">=</span> <span class="op">(</span><span class="dt">double</span> <span class="op">*)</span><a href=http://man7.org/linux/man-pages/man3/malloc.3.html>malloc</a><span class="op">(</span>NX <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">double</span><span class="op">));</span><span id=131></span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">double</span> <span class="op">*</span>ydata <span class="op">=</span> <span class="op">(</span><span class="dt">double</span> <span class="op">*)</span><a href=http://man7.org/linux/man-pages/man3/malloc.3.html>malloc</a><span class="op">(</span>NX <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">double</span><span class="op">));</span><span id=132></span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span id=133></span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">double</span> dx <span class="op">=</span> L0 <span class="op">/</span> <span class="op">(</span>NX <span class="op">-</span> <span class="dv">2</span><span class="op">);</span><span id=134></span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> NX<span class="op">;</span> i<span class="op">++){</span><span id=135></span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    xdata<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> i <span class="op">*</span> dx <span class="op">+</span> X0<span class="op">;</span><span id=136></span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span><span id=137></span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span id=138></span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">// The perturbation is generated only by the main process<span id=139></span></span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>pid<span class="op">()</span> <span class="op">==</span> <span class="dv">0</span><span class="op">){</span><span id=140></span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Initialize the spectrum<span id=141></span></span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    <a href=initial_conditions_dimonte_fft1.h#init_1D_complex>init_1D_complex</a><span class="op">(</span>data<span class="op">,</span> NX<span class="op">,</span> kmin<span class="op">,</span> kmax<span class="op">,</span> eta0_target<span class="op">=</span>amplitude<span class="op">);</span><span id=142></span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    <a href=initial_conditions_dimonte_fft1.h#save_data_for_gnuplot_complex>save_data_for_gnuplot_complex</a><span class="op">(</span>data<span class="op">,</span> NX<span class="op">,</span> <span class="st">&quot;initial_spectra.dat&quot;</span><span class="op">);</span><span id=143></span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span id=144></span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Perform the FFT2D <span id=145></span></span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    gsl_fft_complex_radix2_backward<span class="op">(</span>data<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> NX<span class="op">);</span><span id=146></span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    <a href=initial_conditions_dimonte_fft1.h#save_data_for_gnuplot_complex>save_data_for_gnuplot_complex</a><span class="op">(</span>data<span class="op">,</span> NX<span class="op">,</span> <span class="st">&quot;final_deformation.dat&quot;</span><span class="op">);</span><span id=147></span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span id=148></span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Save the results into a 2D array<span id=149></span></span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> NX<span class="op">;</span> i<span class="op">++){</span><span id=150></span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>      ydata<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> REAL<span class="op">(</span>data<span class="op">,</span>i<span class="op">);</span><span id=151></span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span><span id=152></span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>    <a href=initial_conditions_dimonte_fft1.h#save_data_for_gnuplot_real>save_data_for_gnuplot_real</a><span class="op">(</span>ydata<span class="op">,</span> NX<span class="op">,</span> <span class="st">&quot;final_deformation2.dat&quot;</span><span class="op">);</span><span id=153></span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span><span id=154></span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a><span id=155></span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>  <span class="co">// and broadcasted to the other processes if MPI<span id=156></span></span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>  @ <span class="cf">if</span> _MPI<span id=157></span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>    MPI_Bcast<span class="op">(</span>ydata<span class="op">,</span> NX<span class="op">,</span> MPI_DOUBLE<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> MPI_COMM_WORLD<span class="op">);</span><span id=158></span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>  @endif<span id=159></span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a><span id=160></span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Now, we&#39;ll interpolate the perturbation into the mesh<span id=161></span></span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>  gsl_interp <span class="op">*</span>interp <span class="op">=</span> gsl_interp_alloc<span class="op">(</span>gsl_interp_linear<span class="op">,</span> NX<span class="op">);</span><span id=162></span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>  gsl_interp_accel <span class="op">*</span>acc <span class="op">=</span> gsl_interp_accel_alloc<span class="op">();</span><span id=163></span></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a><span id=164></span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Initialize the interpolation object<span id=165></span></span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>  gsl_interp_init<span class="op">(</span>interp<span class="op">,</span> xdata<span class="op">,</span> ydata<span class="op">,</span> NX<span class="op">);</span><span id=166></span><span id=167></span></span></code></pre></div>
<p>Apply initial condition to the <span class="dt">scalar</span> field. Here, we take care to
normalize the perturbation using the standard deviation and multiply it
by some amplitude.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>  <a href=http://basilisk.fr/Basilisk%20C#foreach_vertex>foreach_vertex</a><span class="op">()</span><span id=174></span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    phi<span class="op">[]</span> <span class="op">=</span> gsl_interp_eval<span class="op">(</span>interp<span class="op">,</span> xdata<span class="op">,</span> ydata<span class="op">,</span> x<span class="op">,</span> acc<span class="op">)</span> <span class="op">-</span> y<span class="op">;</span><span id=175></span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span id=176></span>  </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span id=177></span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Release interpolation objects<span id=178></span></span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  gsl_interp_free<span class="op">(</span>interp<span class="op">);</span><span id=179></span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  gsl_interp_accel_free<span class="op">(</span>acc<span class="op">);</span><span id=180></span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span id=181></span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Free Dynamically Allocated Memory<span id=182></span></span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <a href=http://man7.org/linux/man-pages/man3/free.3.html>free</a><span class="op">(</span>xdata<span class="op">);</span><span id=183></span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <a href=http://man7.org/linux/man-pages/man3/free.3.html>free</a><span class="op">(</span>ydata<span class="op">);</span><span id=184></span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <a href=http://man7.org/linux/man-pages/man3/free.3.html>free</a><span class="op">(</span>data<span class="op">);</span><span id=185></span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span><span id=186></span></span></code></pre></div>
</div>
<div id="footer">
inspired by <a href="http://github.com/jgm/gitit/tree/master/">gitit</a>,
powered by <a href="http://basilisk.fr/src/darcsit/README">darcsit</a>
</div>
          </div>
        </div>
        <div id="sidebar" class="yui-b first">
<div id="logo">
  <a href="http://basilisk.fr/" alt="site logo" title="Go to top page"><img src="http://basilisk.fr/img/logo.png" /></a>
</div>
          <div class="sitenav">
  <fieldset>
    <legend>Site</legend>
    <ul>
      <li><a href="http://basilisk.fr/Front Page">Front page</a></li>
      <li><a href="http://basilisk.fr/_index">All pages</a></li>
      <li><a href="http://basilisk.fr/_activity">Recent activity</a></li>
            <li><a href="http://basilisk.fr/Help">Help</a></li>
    </ul>
    <form action="/_search" method="get" id="searchform">
      <input type="text" name="patterns" id="patterns"/>
      <input type="submit" value="Search"/>
    </form>
  </fieldset>
  <fieldset>
    <legend>Documentation</legend>
    <ul>
      <li><a href="http://basilisk.fr/Tutorial">Tutorial</a></li>
      <li><a href="http://basilisk.fr/src/INSTALL">Installation</a></li>
      <li><a href="http://basilisk.fr/Basilisk C">Basilisk C</a></li>
      <li><a href="http://basilisk.fr/src/README">Solvers and functions</a></li>
      <li><a href="http://basilisk.fr/src/examples/README">Examples</a></li>
      <li><a href="http://groups.google.com/d/forum/basilisk-fr">User forum</a></li>
      <li><a href="http://basilisk.fr/sandbox/documentation">More documentation</a></li>
    </ul>
  </fieldset>
  <fieldset>
    <legend>Development</legend>
    <ul>
      <li><a href="http://basilisk.fr/src/?history">Recent activity</a></li>
      <li><a href="http://basilisk.fr/src/">Source code</a></li>
      <li><a href="https://hub.darcs.net/basilisk/basilisk/browse/src">Darcs Hub</a></li>
      <li><a href="http://basilisk.fr/src/test/README">Test cases</a></li>
      <li><a href="http://basilisk.fr/sandbox/bugs/README">Bug reports</a></li>
      <li><a href="http://basilisk.fr/src/Contributing">How to contribute</a></li>
      <li><a href="http://basilisk.fr/sandbox/">Play in the sandbox</a></li>
    </ul>
  </fieldset>
</div>
                    <div class="pageTools">
  <fieldset>
    <legend>This page</legend>
    <ul>
      <li><a href="http://basilisk.fr/initial_conditions_dimonte_fft1.h?raw">Raw page source</a></li>
      <li><a href="http://basilisk.fr/initial_conditions_dimonte_fft1.h?delete">Delete this page</a></li>
    </ul>
  </fieldset>
</div>
                            </div>
    </div>
    <script src="/js/status.js" type="text/javascript"></script>
      </body>
</html>
